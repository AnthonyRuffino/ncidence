<html ng-app ng-controller="ChatController">

	<head>
		<title ng-bind="title"></title>
		
		<link rel="shortcut icon" type="image/x-icon" href="/img/space/blueships1.png"/>
		
		<script>
	      function ChatController($scope) {
	        var socket = io.connect();
	
	        $scope.messages = [];
	        $scope.roster = [];
	        $scope.name = '';
	        $scope.text = '';
	        $scope.title = '';
	        $scope.owner = '';
	
	        socket.on('connect', function () {
	        	//console.log('connect');
	        });
	        
	        socket.on('whoami', function (me) {
	        	console.log('me', me);
	        });
	
	        socket.on('message', function (msg) {
	          $scope.messages.push(msg);
	          $scope.$apply();
	        });
	        
	        socket.on('connected', function (data) {
	          $scope.title = 'Play ' + data.subdomain;
	          console.log('game', data.owner);
	          $scope.$apply();
	        });
	
	        socket.on('roster', function (names) {
	          $scope.roster = names;
	          $scope.$apply();
	        });
	
	        $scope.send = function send() {
	          socket.emit('message', $scope.text);
	          $scope.text = '';
	        };
	      }
	    </script>
	</head>
	
	
	<body>
		<h1 ng-model="title"></h1>
		<div id="gameDiv"></div>
	</body>
	
	<script>
		
	</script>
	
	<script src="js/renderer.js"></script>
	<script src="/driver"></script>
	<script src="js/gameEngine.js"></script>
	
	
	<script>
		/*global Renderer*/
		/*global GameDriver*/
		/*global GameEngine*/
		
		window.addEventListener('keydown', function(e) {
		  if(e.keyCode == 32 && e.target == document.body) {
		    e.preventDefault();
		  }
		});
		
		gameEngine = (() => {
			if(GameDriver === undefined) {
				window.location.replace("/");
			}
			
			var BOARD_SIZE_PERCENTAGE = .50;
			var DEBUG = true;
		
			var renderer = new Renderer(window, document, "gameDiv", BOARD_SIZE_PERCENTAGE);
			renderer.init();
			
			var driver = new GameDriver(renderer, window.console.log, function(txt) { alert.call(window, txt); });
			if(driver.init) {
				driver.init();
			}
		
		
			if(driver.click) {
				document.onmousedown = function(mouse) {
					var mouseX = mouse.x - driver.renderer.horizontalOffset;
					var mouseY = mouse.y - driver.renderer.verticalOffset;
					driver.click(mouseX, mouseY);
				};
			}
			
		
			if(driver.onkeydown) {
				document.onkeydown = function(event) {
					driver.onkeydown(event);
				};
			}
			
			
			return new GameEngine(renderer, driver, window);
		})();
		gameEngine.start();
		
	</script>
	
	<script src="/socket.io/socket.io.js"></script>
	<script src="/js/angular.min.js"></script>
	
</html>
